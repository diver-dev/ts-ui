var N=Object.defineProperty;var M=(t,o,e)=>o in t?N(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e;var p=(t,o,e)=>(M(t,typeof o!="symbol"?o+"":o,e),e);import{r as b,a8 as T,a9 as j,j as u,a as D,b as L,bI as F,bJ as A,bK as k,bL as _,bM as q,bN as U,bO as E,bP as P,aD as m,bn as V,S as $,z as W,bQ as G,w as H,A as w,L as R,i as J,T as z,B,bR as K,bS as Y,aM as Q,x as X,aJ as Z,aN as ee,a6 as te,bT as re,bU as se}from"./index-BnH1FrvR.js";import{a as le}from"./Checkbox-BfLdzD2m.js";function oe(){var t=new Map;function o(e){var r=e.root,s=e.rootMargin,l=e.threshold,n=t.get(r);n||(n=new Map,t.set(r,n));var c=JSON.stringify({rootMargin:s,threshold:l}),i=n.get(c);if(!i){var d=new Map,h=new IntersectionObserver(function(v){v.forEach(function(a){var g=d.get(a.target);g==null||g(a)})},{root:r,rootMargin:s,threshold:l});i={observer:h,entryCallbacks:d},n.set(c,i)}return{observe:function(a,g){var f,C;(f=i)==null||f.entryCallbacks.set(a,g),(C=i)==null||C.observer.observe(a)},unobserve:function(a){var g,f;(g=i)==null||g.entryCallbacks.delete(a),(f=i)==null||f.observer.unobserve(a)}}}return{getObserver:o}}var ie="0px",ne=[0],ae=oe();function ce(t){var o,e,r=(o=t==null?void 0:t.rootMargin)!=null?o:ie,s=(e=t==null?void 0:t.threshold)!=null?e:ne,l=b.useRef(null),n=b.useRef(null),c=b.useRef(null),i=b.useState(),d=i[0],h=i[1],v=b.useCallback(function(){var C=l.current;if(!C){h(void 0);return}var x=ae.getObserver({root:n.current,rootMargin:r,threshold:s});x.observe(C,function(y){h(y)}),c.current=x},[r,s]),a=b.useCallback(function(){var C=c.current,x=l.current;x&&(C==null||C.unobserve(x)),c.current=null},[]),g=b.useCallback(function(C){a(),l.current=C,v()},[v,a]),f=b.useCallback(function(C){a(),n.current=C,v()},[v,a]);return[g,{entry:d,rootRef:f}]}function S(){return S=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},S.apply(this,arguments)}function ue(t){var o,e=ce(t),r=e[0],s=e[1],l=!!((o=s.entry)!=null&&o.isIntersecting),n=b.useState(l),c=n[0],i=n[1];return l&&!c&&i(!0),[r,S({},s,{isVisible:l,wasEverVisible:c})]}var de=100;function Ie(t){var o=t.loading,e=t.hasNextPage,r=t.onLoadMore,s=t.rootMargin,l=t.disabled,n=t.delayInMs,c=n===void 0?de:n,i=ue({rootMargin:s}),d=i[0],h=i[1],v=h.rootRef,a=h.isVisible,g=!l&&!o&&a&&e;return b.useEffect(function(){if(g){var f=setTimeout(function(){r()},c);return function(){clearTimeout(f)}}},[r,g,c]),[d,{rootRef:v}]}var I={},he=j;Object.defineProperty(I,"__esModule",{value:!0});var O=I.default=void 0,ve=he(T()),ge=u;O=I.default=(0,ve.default)((0,ge.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");const fe=t=>({root:{width:"100%",maxWidth:360,backgroundColor:t.palette.background.paper},paper:{height:254,width:243,margin:10,textAlign:"center",minWidth:230,maxWidth:"257px"},dialogContent:{paddingTop:"5px",padding:"0px 5px 5px 5px"},space:{height:20},fullPageXs:{[t.breakpoints.down("xs")]:{width:"100%",height:"100%",margin:0,overflowY:"auto"}},followButton:{position:"absolute",bottom:"30px",left:0,right:0},dialog:{width:"",maxWidth:"280px",borderRadius:"4px"}});class Ce extends b.Component{constructor(e){super(e);p(this,"handleDoneAddCircle",()=>{const{user:e,addUserToCircle:r,selectedCircles:s,deleteFollowingUser:l,avatar:n,fullName:c}=this.props,i=e.get("userId"),{disabledDoneCircles:d}=this.state;!d&&s&&r&&l&&(s.count()>0?r(s,{avatar:n,userId:i,fullName:c}):l(i))});p(this,"onFollowUser",e=>{e.preventDefault();const{isFollowed:r,followUser:s,followingCircle:l,user:n,followRequest:c,avatar:i,fullName:d}=this.props,h=n.get("userId");!s||!l||c&&c.status===w.Sent||(r?this.onRequestOpenAddCircle():l?s(l.get("id"),{avatar:i,userId:h,fullName:d}):s(h,{avatar:i,userId:h,fullName:d}))});p(this,"onRequestCloseAddCircle",()=>{const{setSelectedCircles:e,user:r,userBelongCircles:s,closeSelectCircles:l}=this.props,n=r.get("userId");!e||!s||!l||(e(n,s),l(n),this.setState({circleName:"",disabledCreateCircle:!0,disabledDoneCircles:!0}))});p(this,"onRequestOpenAddCircle",()=>{const{openSelectCircles:e,user:r,followingCircle:s}=this.props,l=r.get("userId");s&&e&&e(l)});p(this,"onCreateCircle",()=>{const{circleName:e}=this.state,{createCircle:r}=this.props;r&&e&&e.trim()!==""&&(r(this.state.circleName),this.setState({circleName:"",disabledCreateCircle:!0}))});p(this,"handleChangeName",e=>{this.setState({circleName:e.target.value,disabledCreateCircle:e.target.value===void 0||e.target.value.trim()===""})});p(this,"handleSelectCircle",(e,r)=>{const{setSelectedCircles:s,selectedCircles:l,user:n}=this.props,c=n.get("userId");if(!l||!s)return;let i=l;if(e.target.checked)i=l.push(r);else{const d=l.indexOf(r);i=i.remove(d)}s(c,i),this.setState({disabledDoneCircles:!this.selectedCircleChange(i)})});p(this,"circleList",()=>{const{circles:e,user:r,selectedCircles:s,classes:l,t:n}=this.props,c=r.get("userId"),i=[];return e?(e.forEach((d,h)=>{const v=s?s.indexOf(h)>-1:!1,a=d.get("name");i.push(u.jsxs(R,{dense:!0,className:l.listItem,children:[u.jsx(J,{children:u.jsx(le,{onChange:g=>this.handleSelectCircle(g,h),checked:v})}),u.jsx(z,{variant:"subtitle1",className:l.title,color:"textPrimary",gutterBottom:!0,children:a==="Following"?n("userBox.followingLabel"):a})]},`${h}-${c}`))}),i):[]});p(this,"selectedCircleChange",e=>{let r=!1;const{userBelongCircles:s}=this.props;if(!s||!e)return!1;if(e.count()===s.count())for(let l=0;l<e.count();l++){const n=e.get(l,"");if(!(s.indexOf(n)>-1)){r=!0;break}}else r=!0;return r});this.state={circleName:"",disabledCreateCircle:!0,disabledDoneCircles:!0},this.handleChangeName=this.handleChangeName.bind(this),this.onCreateCircle=this.onCreateCircle.bind(this),this.handleDoneAddCircle=this.handleDoneAddCircle.bind(this),this.circleList=this.circleList.bind(this)}render(){const{disabledDoneCircles:e}=this.state,{isFollowed:r,firstBelongCircle:s,belongCirclesCount:l,followRequest:n,user:c,isSelecteCirclesOpen:i,addToCircleRequest:d,deleteFollowingUserRequest:h,classes:v,t:a}=this.props,g=c.get("userId");if(!a)return u.jsx("div",{});const f=r?(l||0)>1?a("userBox.numberOfCircleButton",{circlesCount:l}):s?s.get("name",a("userBox.followedLabel")):a("userBox.followButton"):a("userBox.followButton");return u.jsxs(u.Fragment,{children:[u.jsx(B,{color:this.props.color||"primary",onClick:this.onFollowUser,disabled:(n?n.status===w.Sent:!1)||(h?h.status===w.Sent:!1),variant:this.props.variant,children:f==="Following"?a("userBox.followingLabel"):f}),u.jsxs(K,{fullWidth:!0,open:i===!0,onClose:this.onRequestCloseAddCircle,children:[u.jsx(Y,{title:a("userBox.manageGroupsTitle"),onRequestClose:this.onRequestCloseAddCircle}),u.jsx(Q,{className:v.dialogContent,children:u.jsxs(X,{children:[this.circleList(),u.jsx("div",{className:v.space}),u.jsx(Z,{}),u.jsxs(R,{children:[u.jsx(ee,{autoFocus:!0,placeholder:a("userBox.groupNamePlaceholder"),onChange:this.handleChangeName,value:this.state.circleName,fullWidth:!0,sx:{padding:"11.5px â€‹14p"}}),u.jsx(te,{onClick:this.onCreateCircle,disabled:this.state.disabledCreateCircle,children:u.jsx(re,{title:a("userBox.createCircleTooltip"),children:u.jsx(O,{})})})]},`'circleName'-${g}`)]})}),u.jsx(se,{children:u.jsx(B,{color:"primary",disableFocusRipple:!0,disableRipple:!0,disabled:e||(d?d.status===w.Sent:!1),onClick:this.handleDoneAddCircle,children:a("userBox.doneButton")})})]},g)]})}}const be=t=>({createCircle:o=>t(F(o)),addUserToCircle:(o,e)=>t(A(o,e)),followUser:(o,e)=>t(k(o,e)),deleteFollowingUser:o=>t(_(o)),setSelectedCircles:(o,e)=>t(q(o,e)),removeSelectedCircles:o=>t(U(o)),openSelectCircles:o=>t(E(o)),closeSelectCircles:o=>t(P(o))}),pe=(t,o)=>{const e=o.user.get("userId"),r=t.getIn(["circle","circleList"],m({})),s=t.getIn(["circle","userTies",e,"circleIdList"],V()),l=s.count()>0,n=r.filter(a=>a.get("isSystem",!1)&&a.get("name")==="Following").first(m({})),c=$.createServerRequestId(W.CircleFollowUser,e),i=t.getIn(["server","request",c]),d=t.getIn(["circle","selectedCircles",e],[]),h=t.getIn(["circle","ui","openSelecteCircles",e],[]),v=G.getUserProfileById(t,{userId:e});return{isSelecteCirclesOpen:h,isFollowed:l,selectedCircles:d,circles:r,followingCircle:n,userBelongCircles:s,followRequest:i,belongCirclesCount:s.count()||0,firstBelongCircle:s?r.get(s.get(0),m({})):m({}),avatar:v.get("avatar",""),fullName:v.get("fullName","")}},xe=H("translations")(Ce),Re=D(pe,be)(L(fe)(xe));export{Re as F,Ie as u};
